from aiogram import Router, types, F
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from config import CHAT_LINK

router = Router()

# –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ –æ —Ñ–æ—Ä–º–∞—Ç–µ
VIDEO_URL = "https://www.youtube.com/watch?v=x3Ir917gDiM&list=PLDqVqfBsY9O-fPcm-pK-TpYWfnuJWSBFI"

SCREENS = [
    {
        "title": "–ß—Ç–æ –∑–∞ —Ñ–æ—Ä–º–∞—Ç?",
        "text": (
            "–°—é–∂–µ—Ç–Ω–∞—è –∏–≥—Ä–∞ (—Ä–æ–ª–µ–≤–æ–π –∫–≤–µ—Å—Ç) ‚Äî —ç—Ç–æ –∫–∞–∫ —Ñ–∏–ª—å–º, —Ç–æ–ª—å–∫–æ —Ç—ã –≤–Ω—É—Ç—Ä–∏ –∏—Å—Ç–æ—Ä–∏–∏.\n\n"
            "–¢–µ–±–µ –¥–∞—é—Ç —Ä–æ–ª—å –∏ —Ü–µ–ª—å, –¥–∞–ª—å—à–µ —Å–æ–±—ã—Ç–∏—è —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –æ–±—â–µ–Ω–∏–µ –∏ —Ä–µ—à–µ–Ω–∏—è. "
            "–í–µ–¥—É—â–∏–π –≤—Å—ë –≤–µ–¥—ë—Ç –∏ –ø–æ–º–æ–≥–∞–µ—Ç."
        ),
    },
    {
        "title": "–ù–µ —Å –∫–µ–º?",
        "text": (
            "–ï—Å–ª–∏ –Ω–µ —Å –∫–µ–º –≤—ã–±—Ä–∞—Ç—å—Å—è –≤ –ª—é–¥–∏ ‚Äî —ç—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.\n\n"
            "–ú–æ–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –æ–¥–Ω–æ–º—É/–æ–¥–Ω–æ–π: —Ç–µ–±—è –º—è–≥–∫–æ –≤–∫–ª—é—á–∞—Ç –≤ –∏–≥—Ä—É, –∏ –∫–æ–º–ø–∞–Ω–∏—è –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–∞–º–∞."
        ),
    },
    {
        "title": "–ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞ –±–µ–∑ –∫—Ä–∏–Ω–∂–∞",
        "text": (
            "–ó–¥–µ—Å—å –Ω–µ –Ω—É–∂–Ω–æ ¬´–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ¬ª.\n\n"
            "–ï—Å—Ç—å —Å—é–∂–µ—Ç –∏ –æ–±—â–∞—è –∑–∞–¥–∞—á–∞ ‚Äî —Ä–∞–∑–≥–æ–≤–æ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–∞–º, –∏ –≤—Å—ë –ø–æ–ª—É—á–∞–µ—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ."
        ),
    },
    {
        "title": "–ù–∞–¥–æ–µ–ª–æ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ",
        "text": (
            "–ï—Å–ª–∏ —É—Å—Ç–∞–ª(–∞) –æ—Ç ¬´–±–∞—Ä/–∫–∏–Ω–æ/–ø—Ä–æ—Å—Ç–æ –ø–æ—Å–∏–¥–µ—Ç—å¬ª ‚Äî —ç—Ç–æ –¥—Ä—É–≥–æ–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—É–≥–∞.\n\n"
            "–í–º–µ—Å—Ç–æ —Ñ–æ–Ω–∞ ‚Äî —ç–º–æ—Ü–∏–∏, –∏–Ω—Ç—Ä–∏–≥–∞, —Å–º–µ—Ö –∏ –æ—â—É—â–µ–Ω–∏–µ ¬´–≤–∞—É, –±—ã–ª–æ –Ω–µ –∫–∞–∫ –æ–±—ã—á–Ω–æ¬ª."
        ),
    },
    {
        "title": "–Ø –Ω–µ —É–º–µ—é / —è –∏–Ω—Ç—Ä–æ–≤–µ—Ä—Ç",
        "text": (
            "–ù–∏–∫–∞–∫–æ–≥–æ –æ–ø—ã—Ç–∞ –Ω–µ –Ω—É–∂–Ω–æ. –ù–µ –Ω–∞–¥–æ –±—ã—Ç—å –∞–∫—Ç—ë—Ä–æ–º –∏ ¬´–∏–≥—Ä–∞—Ç—å —Ä–æ–ª—å¬ª.\n\n"
            "–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ—Å—Ç—ã–µ, –≤–∫–ª—é—á–∏—Ç—å—Å—è –º–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ ‚Äî –≤–µ–¥—É—â–∏–π –ø–æ–¥—Å–∫–∞–∂–µ—Ç, –∫–∞–∫ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å."
        ),
    },
    {
        "title": "–•–æ—á—É —Å–≤–æ—é —Ç—É—Å–æ–≤–∫—É –≤ –ï–ö–ë",
        "text": (
            "–ú—ã —Å–æ–±–∏—Ä–∞–µ–º –∫–æ–º—å—é–Ω–∏—Ç–∏ –≤ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–µ: —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –∏ ¬´—Å–≤–æ–∏¬ª –ª—é–¥–∏.\n\n"
            "–ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç—É–ø–∏—Ç—å –≤ —á–∞—Ç, –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è –∏ –≤—ã–±—Ä–∞—Ç—å —É–¥–æ–±–Ω—É—é –¥–∞—Ç—É."
        ),
    },
    {
        "title": "–ì–æ—Ç–æ–≤(–∞) –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å?",
        "text": (
            "–ß–∞—Å—Ç–∞—è —Ä–µ–∞–∫—Ü–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∏–≥—Ä—ã:\n"
            "¬´–ü—Ä–∏—à—ë–ª(–ª–∞) –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏–π ‚Äî –≤—Ç—è–Ω—É–ª—Å—è(–∞—Å—å) –∑–∞ 10 –º–∏–Ω—É—Ç –∏ —É—à—ë–ª(–ª–∞) —Å –Ω–æ–≤—ã–º–∏ –∑–Ω–∞–∫–æ–º—ã–º–∏¬ª.\n\n"
            "–ì–æ—Ç–æ–≤(–∞) –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å? –í—ã–±–∏—Ä–∞–π: –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –±–ª–∏–∂–∞–π—à—É—é –∏–≥—Ä—É –∏–ª–∏ –∑–∞–π—Ç–∏ –≤ —á–∞—Ç."
        ),
    },
]


def cta_keyboard(screen_idx: int):
    """–ï–¥–∏–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∫–Ω–æ–ø–æ–∫ –Ω–∞ –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–∞—Ö: –í–∏–¥–µ–æ ‚Üí –î–∞–ª—å—à–µ ‚Üí –ó–∞–ø–∏—Å–∞—Ç—å—Å—è/–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Üí –ß–∞—Ç ‚Üí –ù–∞–∑–∞–¥."""
    kb = []
    kb.append([InlineKeyboardButton(text="üé¨ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ", url=VIDEO_URL)])
    if screen_idx < len(SCREENS) - 1:
        kb.append([InlineKeyboardButton(text="‚ú® –î–∞–ª—å—à–µ", callback_data=f"format_{screen_idx + 1}")])
    kb.extend([
        [
            InlineKeyboardButton(text="üéØ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è", callback_data="menu_record"),
            InlineKeyboardButton(text="üìÜ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ", callback_data="menu_schedule"),
        ],
        [InlineKeyboardButton(text="üí¨ –í—Å—Ç—É–ø–∏—Ç—å –≤ —á–∞—Ç", url=CHAT_LINK)],
    ])
    back_data = "menu_back" if screen_idx == 0 else f"format_{screen_idx - 1}"
    kb.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=back_data)])
    return InlineKeyboardMarkup(inline_keyboard=kb)


# –ß—Ç–æ —ç—Ç–æ –∑–∞ —Ñ–æ—Ä–º–∞—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ main.py handle_menu


async def format_show_screen(target, screen_idx: int):
    s = SCREENS[screen_idx]
    text = f"**{s['title']}**\n\n{s['text']}"
    kb = cta_keyboard(screen_idx)
    if hasattr(target, "bot") and hasattr(target, "message"):
        await target.bot.edit_message_text(
            chat_id=target.message.chat.id,
            message_id=target.message.message_id,
            text=text,
            reply_markup=kb,
            parse_mode="Markdown",
        )
    else:
        await target.answer(text, reply_markup=kb, parse_mode="Markdown")


@router.callback_query(F.data.startswith("format_"))
async def format_next(callback: types.CallbackQuery):
    try:
        await callback.answer()
    except Exception:
        pass  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö callback'–æ–≤
    idx = int(callback.data.split("_")[1])
    await format_show_screen(callback, idx)
